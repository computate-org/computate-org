
all: 
  vars: 
    PROJECT_LANG: enUS
    PROJECT_SRC: /usr/local/src/rhedar
    PROJECT_PREFIX: rhedar-
    PROJECT_POM_GROUP_ID: com.redhat.rhedar
    PROJECT_POM_ARTIFACT_ID_ROOT: "{{ PROJECT_PREFIX }}root"
    PROJECT_POM_ARTIFACT_ID_PARENT: "{{ PROJECT_PREFIX }}parent"
    PROJECT_POM_VERSION: "${revision}"
    PROJECT_POM_VERSION_PREFIX: "1.0.0.0"
    PROJECT_POM_VERSION_SUFFIX_LOCAL: ".local"
    PROJECT_JAVA_PACKAGE: "{{ PROJECT_POM_GROUP_ID }}"
    PROJECT_RP_SRC: "{{ PROJECT_SRC }}/{{ PROJECT_PREFIX }}rp"
    PROJECTS: 

      ###############
      # rhedar-root #
      ###############

      - PROJECT_SRC: "{{ PROJECT_SRC }}"
        PROJECT_POM: 
          template: "pom.xml"
          groupId: "{{ PROJECT_POM_GROUP_ID }}"
          artifactId: "{{ PROJECT_PREFIX }}root"
          name: "RHEDAR base project"
          description: "Red Hat Event Driven Automated Remediation base project"
          version: "{{ PROJECT_POM_VERSION }}"
          packaging: pom
          modules: 
            - "{{ PROJECT_PREFIX }}parent"
            - "{{ PROJECT_PREFIX }}rp"
          properties: 
            - name: baseRevision
              value: "{{ PROJECT_POM_VERSION_PREFIX }}"
            - name: revision
              value: "${baseRevision}{{ PROJECT_POM_VERSION_SUFFIX_LOCAL }}"
            - name: maven.min.version
              value: 3.3.9
            - name: project.build.sourceEncoding
              value: UTF-8
            - name: project.reporting.outputEncoding
              value: UTF-8
            - name: maven.compiler.source
              value: 1.8
            - name: maven.compiler.target
              value: 1.8
            - name: jdk.min.version
              value: ${maven.compiler.source}
            - name: platform-bom.version
              value: 7.8.1.redhat-00002
            - name: fuse.version
              value: 7.6.0.fuse-760027-redhat-00001
            - name: kie.version
              value: 7.39.0.Final-redhat-00007
            - name: junit.version
              value: 4.12
            - name: kafka.version
              value: 1.0.0
            - name: resteasy.version
              value: 3.5.1.Final-redhat-1
            - name: spring-data-releasetrain.version
              value: Fowler-SR2
            - name: spring-boot.version
              value: 2.1.6.RELEASE
            - name: spring-boot-bom.version
              value: 2.1.6.Final
            - name: cucumber.version
              value: 1.2.5
            - name: hamcrest-library.version
              value: 1.3-redhat-1
            - name: maven-compiler-plugin.version
              value: 3.8.0
            - name: maven-surefire-plugin.version
              value: 2.19.1
            - name: maven-war-plugin.version
              value: 2.3
            - name: jpmml.version
              value: 1.4.9
            - name: hawtio-springboot.version
              value: 2.0.0.fuse-000201-redhat-3
            - name: maven-shade-plugin.version
              value: 2.3
            - name: maven-jarsigner-plugin.version
              value: 1.4
            - name: properties-maven-plugin.version
              value: 1.0.0

            #######################
            # Vert.X dependencies #
            #######################

            - name: vertx-maven-plugin.version
              value: 1.0.9
            - name: build-helper-maven-plugin.version
              value: 3.0.0
            - name: exec-maven-plugin.version
              value: 1.5.0
            - name: vertx.version
              value: 3.8.5
          profiles: 
            - id: jenkins
              activation: 
                property: 
                  - name: env.BUILD_NUMBER
              properties: 
                - name: revision
                  value: ${baseRevision}.${env.BUILD_NUMBER}

      #################
      # rhedar-parent #
      #################

      - PROJECT_SRC: "{{ PROJECT_SRC }}/{{ PROJECT_POM_ARTIFACT_ID_PARENT }}"
        PROJECT_POM: 
          template: "pom.xml"
          parent: 
            groupId: "{{ PROJECT_POM_GROUP_ID }}"
            artifactId: "{{ PROJECT_POM_ARTIFACT_ID_ROOT }}"
            version: "{{ PROJECT_POM_VERSION }}"
          artifactId: "{{ PROJECT_POM_ARTIFACT_ID_PARENT }}"
          name: "RHEDAR parent project"
          description: "Red Hat Event Driven Automated Remediation parent project"
          dependencyManagement: 
            - groupId: org.jboss.redhat-fuse
              artifactId: fuse-springboot-bom
              version: ${fuse.version}
              scope: import
              type: pom
            - groupId: com.redhat.ba
              artifactId: ba-platform-bom
              version: ${platform-bom.version}
              scope: import
              type: pom
            - groupId: org.springframework.data
              artifactId: spring-data-releasetrain
              version: ${spring-data-releasetrain.version}
              scope: import
              type: pom
            - groupId: org.springframework.boot
              artifactId: spring-boot-dependencies
              version: ${spring-boot.version}
              scope: import
              type: pom
          dependencies: 
            - groupId: org.apache.camel
              artifactId: camel-core
              commentGroup: Fuse/Camel
            - groupId: org.apache.camel
              artifactId: camel-kafka
            - groupId: org.apache.camel
              artifactId: camel-stream
            - groupId: org.springframework.boot
              artifactId: spring-boot-starter-actuator
              commentGroup: Spring
              exclusions: 
                - groupId: org.springframework.boot
                  artifactId: spring-boot-starter-logging
            - groupId: org.springframework.boot
              artifactId: spring-boot-starter-web
              exclusions: 
                - groupId: org.springframework.boot
                  artifactId: spring-boot-starter-tomcat
                - groupId: org.springframework.boot
                  artifactId: spring-boot-starter-logging
            - groupId: org.springframework.boot
              artifactId: spring-boot-starter-undertow
              exclusions: 
                - groupId: org.springframework.boot
                  artifactId: spring-boot-starter-logging
            - groupId: org.apache.camel
              artifactId: camel-spring-boot-starter
              commentGroup: Camel
              exclusions: 
                - groupId: org.springframework.boot
                  artifactId: spring-boot-starter-logging
            - groupId: junit
              artifactId: junit
              scope: test
              commentGroup: Testing
            - groupId: org.jboss.arquillian.junit
              artifactId: arquillian-junit-container
              scope: test
            - groupId: org.arquillian.cube
              artifactId: arquillian-cube-openshift
              scope: test
#            - groupId: info.cukes
#              artifactId: cucumber-junit
#              version: ${cucumber.version}
#              scope: test
#            - groupId: org.hamcrest
#              artifactId: hamcrest-library
#              scope: test
#            - groupId: io.hawt
#              artifactId: hawtio-springboot
#              version: ${hawtio-springboot.version}
#            - groupId: io.hawt
#              artifactId: hawtio-core
#            - groupId: org.jpmml
#              artifactId: pmml-evaluator
#              version: ${jpmml.version}
#            - groupId: org.jpmml
#              artifactId: pmml-evaluator-extension
#              version: ${jpmml.version}
#            - groupId: com.google.code.gson
#              artifactId: gson
#            - groupId: org.jboss.resteasy
#              artifactId: resteasy-client
#              version: ${resteasy.version}
#            - groupId: org.jboss.errai
#              artifactId: errai-jaxrs-client
#              commentGroup: Other
          build: 
            pluginManagement:
              plugins: 
                - groupId: "org.jboss.redhat-fuse"
                  artifactId: "spring-boot-maven-plugin"
                  version: ${fuse.version}
                  executions: 
                    - goals: 
                        - repackage
            plugins:
              - artifactId: maven-compiler-plugin
                version: ${maven-compiler-plugin.version}
                configuration: 
                  target: ${maven.compiler.target}
                  source: ${maven.compile.source}
                  encoding: UTF-8
                  debug: true
                  debugLevel: lines,vars,source
              - groupId: org.apache.maven.plugins
                artifactId: maven-surefire-plugin
                version: ${maven-surefire-plugin.version}
                configuration: 
                  argLine: "-DenableImageStreamDetection=true"
                  excludes: 
                    - "**/*KT.java"

      #############
      # rhedar-rp #
      #############

      - PROJECT_SRC: "{{ PROJECT_RP_SRC }}"
        PROJECT_POM: 
          template: "pom.xml"
          parent: 
            groupId: "{{ PROJECT_POM_GROUP_ID }}"
            artifactId: "{{ PROJECT_POM_ARTIFACT_ID_ROOT }}"
            version: "{{ PROJECT_POM_VERSION }}"
          artifactId: "{{ PROJECT_PREFIX }}rp"
          name: "RHEDAR responsible party router project"
          description: "Red Hat Event Driven Automated Remediation responsible party router project"
          dependencyManagement: 
            - groupId: org.springframework.data
              artifactId: spring-data-releasetrain
              version: ${spring-data-releasetrain.version}
              scope: import
              type: pom
            - groupId: org.springframework.boot
              artifactId: spring-boot-dependencies
              version: ${spring-boot.version}
              scope: import
              type: pom
            - groupId: io.vertx
              artifactId: vertx-dependencies
              version: ${vertx.version}
              scope: import
              type: pom
          dependencies: 
            - groupId: "org.springframework.boot"
              artifactId: "spring-boot-starter"
              commentGroup: "Spring"
            - groupId: "org.springframework.boot"
              artifactId: "spring-boot-starter-web"
            - groupId: "org.springframework.boot"
              artifactId: "spring-boot-starter-data-jpa"
            - groupId: "org.springframework.data"
              artifactId: "spring-data-commons"
            - groupId: "org.postgresql"
              artifactId: "postgresql"
              commentGroup: "PostgreSQL"
            - groupId: "org.springframework.boot"
              artifactId: "spring-boot-starter-test"
              scope: test
              exclusions: 
                - groupId: "org.junit.vintage"
                  artifactId: "junit-vintage-engine"
              commentGroup: "Testing"
            - groupId: "com.h2database"
              artifactId: "h2"
              scope: test
            - groupId: "junit"
              artifactId: "junit"
              scope: test

              #######################
              # Vert.X dependencies #
              #######################

            - groupId: commons-beanutils
              artifactId: commons-beanutils
              version: 1.9.4
            - groupId: org.apache.commons
              artifactId: commons-configuration2
              version: 2.7
            - groupId: commons-dbutils
              artifactId: commons-dbutils
              version: 1.7
            - groupId: org.apache.commons
              artifactId: commons-exec
              version: 1.3
            - groupId: org.apache.commons
              artifactId: commons-text
              version: 1.8
            - groupId: org.postgresql
              artifactId: postgresql
              version: 42.2.2.jre7
            - groupId: org.apache.solr
              artifactId: solr-solrj
              version: 8.4.1
            - groupId: org.xhtmlrenderer
              artifactId: flying-saucer-core
              version: 9.1.19
            - groupId: org.xhtmlrenderer
              artifactId: flying-saucer-swt
              version: 9.1.19
            - groupId: org.xhtmlrenderer
              artifactId: flying-saucer-pdf-itext5
              version: 9.1.19
            - groupId: com.github.librepdf
              artifactId: openpdf
              version: 1.3.11
            - groupId: com.itextpdf
              artifactId: itext-asian
              version: 5.2.0

            - groupId: io.vertx
              artifactId: vertx-core
            - groupId: io.vertx
              artifactId: vertx-web
            - groupId: io.vertx
              artifactId: vertx-pg-client
            - groupId: io.vertx
              artifactId: vertx-auth-oauth2
            - groupId: io.vertx
              artifactId: vertx-reactive-streams
            - groupId: io.vertx
              artifactId: vertx-sql-common
            - groupId: io.vertx
              artifactId: vertx-web-api-contract
            - groupId: io.vertx
              artifactId: vertx-codegen
            - groupId: io.vertx
              artifactId: vertx-service-proxy
            - groupId: io.vertx
              artifactId: vertx-web-api-service
            - groupId: io.vertx
              artifactId: vertx-mail-client
            - groupId: io.vertx
              artifactId: vertx-health-check

            - groupId: io.opentracing.contrib
              artifactId: opentracing-vertx-web
              version: 0.1.0
            - groupId: io.opentracing.contrib
              artifactId: opentracing-solr-client
              version: 0.1.0
            - groupId: org.jfree
              artifactId: jfreechart
              version: 1.5.0
            - groupId: junit
              artifactId: junit
              version: 4.13.1
              scope: test
          build: 
            resources:
              - directory: src/main/resources
            plugins: 
              - groupId: "org.springframework.boot"
                artifactId: "spring-boot-maven-plugin"
#              - groupId: org.codehaus.mojo
#                artifactId: properties-maven-plugin
#                version: ${properties-maven-plugin.version}
#                executions:
#                  - phase: initialize
#                    goals:
#                      - read-project-properties
#                    configuration:
#                      files:
#                        - /opt/keystore/{{ PROJECT_NAME }}-keystore.properties
              - artifactId: maven-compiler-plugin
                version: ${maven-compiler-plugin.version}
                configuration:
                  source: 1.8
                  target: 1.8
                  annotationProcessors:
                    - io.vertx.codegen.CodeGenProcessor
              - groupId: org.codehaus.mojo
                artifactId: build-helper-maven-plugin
                version: ${build-helper-maven-plugin.version}
                executions: 
                  - phase: generate-sources
                    goals: 
                      - add-source
                    configuration: 
                      sources: 
                        - src/gen/java
                        - target/generated-sources/annotations
          profiles: 
            - id: openshift
              build:
#                plugins:
#                  - groupId: org.apache.maven.plugins
#                    artifactId: maven-shade-plugin
#                    version: ${maven-shade-plugin.version}
#                    executions:
#                      - phase: package
#                        goals:
#                          - shade
#                        configuration:
#                          filters:
#                            - artifact: "*:*"
#                              excludes:
#                                - META-INF/*.SF
#                                - META-INF/*.DSA
#                                - META-INF/*.RSA
#                          transformers:
#                            - implementation: org.apache.maven.plugins.shade.resource.ManifestResourceTransformer
#                  - groupId: org.apache.maven.plugins
#                    artifactId: maven-jarsigner-plugin
#                    version: ${maven-jarsigner-plugin.version}
#                    executions:
#                      - id: sign
#                        goals:
#                          - sign
#                      - id: verify
#                        goals:
#                          - verify
#                    configuration:
#                      keystore: ${keystore-path}
#                      alias: ${keystore-alias}
#                      storepass: ${keystore-storepass}
#                      keypass: ${keystore-keypass}
              activation: 
                property: 
                  - name: env.BUILD_NUMBER
              properties: 
                - name: revision
                  value: ${baseRevision}.${env.BUILD_NUMBER}
        PROJECT_FILES: 
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/wrap/Wrap.java"
            template: Wrap.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/request/SiteRequestEnUS.java"
            template: SiteRequestEnUS.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/config/SiteConfig.java"
            template: SiteConfig.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/context/SiteContextEnUS.java"
            template: SiteContextEnUS.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/request/api/ApiRequest.java"
            template: ApiRequest.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/search/SearchList.java"
            template: SearchList.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/search/SearchResult.java"
            template: SearchResult.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/writer/AllWriter.java"
            template: AllWriter.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/writer/AllWriters.java"
            template: AllWriters.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/writer/ApiWriter.java"
            template: ApiWriter.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/design/PageDesign.java"
            template: PageDesign.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/html/part/HtmlPart.java"
            template: HtmlPart.java
#          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/page/PageLayout.java"
#            template: PageLayout.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/vertx/AppOpenApi3.java"
            template: AppOpenApi3.java
#          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/vertx/AppRestore.java"
#            template: AppRestore.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/vertx/AppSwagger2.java"
            template: AppSwagger2.java
#          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/vertx/AppVertx.java"
#            template: AppVertx.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/user/SiteUser.java"
            template: SiteUser.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/cluster/Cluster.java"
            template: Cluster.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/escape/EscapeTool.java"
            template: EscapeTool.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/xml/UtilXml.java"
            template: UtilXml.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/java/LocalDateSerializer.java"
            template: LocalDateSerializer.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/java/LocalTimeSerializer.java"
            template: LocalTimeSerializer.java
          - path: "{{ PROJECT_RP_SRC }}/src/main/java/{{ PROJECT_JAVA_PACKAGE | replace('.', '/') }}/java/ZonedDateTimeSerializer.java"
            template: ZonedDateTimeSerializer.java
redhat_project: 
  hosts: 
    localhost.localdomain: 